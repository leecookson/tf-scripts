#!/usr/bin/env bash

# source tfcommon from same bin folder
. "$(dirname $(realpath $0))/tfcommon"

is_tf_folder $folder || usage

setupworkfolder $folder || { echo "Failed to setup work folder $folder"; exit 1; }

terraform init -migrate-state -upgrade

# since there should be no code when a lambda is being destroyed, we can skip the build step

terraform plan -input=false -destroy -out plan.tfplan

terraform apply "plan.tfplan"
