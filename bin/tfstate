#!/usr/bin/env bash

# source tfcommon from same bin folder
. "`dirname $(realpath $0)`/tfcommon"

folder=${1:-.}
state_cmd=${2:-show}
resource_address=${3}

if [[ -z "$state_cmd" ]] || [[ -z "$resource_address" ]]; then
  echo "usage: $0 <folder> <state_cmd> <resource_address>"
  exit 1
fi

echo "checking $folder"

is_tf_folder $folder || exit 1

cd $folder
backend_params=$(setupbackend)

echo $backend_params

terraform init $backend_params

set -x
terraform state $state_cmd $resource_address
